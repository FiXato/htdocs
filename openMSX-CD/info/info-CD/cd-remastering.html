<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<HTML>
<HEAD>
<TITLE>openMSX-CD info</TITLE>
<link rel="stylesheet" href="manual.css" type="text/css">
<META http-equiv="Content-Type" content="text/html; charset=us-ascii">
<META name="keywords" content="openmsx msx emulator bootable CD">
<META name="description" content="openMSX-CD">
</HEAD>
<BODY>

<p>
<h1>openMSX-CD remastering</h1>
<p>
If you downloaded the "bare bones" edition fo the openMSX-CD, then you 'll propably want to remaster the CD so that you can add some system-roms to the CD.</p>
<p>There are two ways to remaster your CD, the automatic way and a more complex manual one. Ofcourse the automatic procedure is the recommended one. Unless you fail the filesystem prerequisite there is no reason way you would want to perform a manual remaster.</p>
<h2>The prerequisites</h2>
These dependencies are valid for both remaster methods.
<ul>
<li>A disk with aproximately 2 gigabyte of free space (in one partition)<br>
The supported filesystems to perform the remastering are ext2/ext3 (regular Linux filesystems)<br>
or vfat (used by win9x,Milenium and XP if chosen during install).</p>
<li>A text editor capable of saving files in the unix text format<br>(for example vim, available from http://www.vim.org/)
<li>(optional) Rom images extracted from your own real MSX machine
<li>(optional) Extra MSX software
</ul>


<h2>The almost automatic way</h2>
<p>This is the only way win32 user can use to remaster the openMSX-CD</p>
<p>Here are the steps you need to follow:</p>
<ol><li>Create a subdirectory on the disk that has the needed space.<br>
<B>VERY IMPORTANT: </B>
<ul><li>The subdirectory name can't have spaces in them. So using for instance &quot;C:\My&nbsp;Documents\new&nbsp;openMSX\&quot; is out of the question.
<li>Keep the name as short as possible and do not use too many subdirectories!<br>
So &quot;C:\newcd\&quot; is highly prefered above &quot;D:\temp\remastering\msx\newproject\openmsxcd&quot;
</ul>
<li>In this subdirectory create a file with the name 'remaster-openmsx-here'. The content is not important, only the filename is. Make sure it is all lower-caser! If you are using Windows then it is possible that your file explorer will show the new name with a capital first letter, ignore this. Simply make sure that you typed in all letters in lower case when creating the file. The lettercasing is unimportant for Windows, but since the automated remastering runs under a case senitive OS this is of importance if you want the rest of the remastering to succeed.
<li>Reboot your PC so that the openMSX-CD is started and as extra boot parameter use 'remaster'. You're entire line could be for example :"msx nosplash remaster"
<li>The programs will now prepare some files and directories in the same directory as the 'remaster-openmsx-here' file and halt your computer as soon as this is ready.
<li>Reboot in your prefered OS and add/alter/remove files in the newly created subdirs.<br>
<ul>
<li>You can add systemroms in the share directory
<li>Change the available BGM music midi's in the 'midi' directory
<li>Or alter the splashscreen in the 'splash' directory
<li>If you want to alter the software selection go into the SOFTWARE directory<br>
if you want new software to be searchable in the textual menu, you'll have to edit the 'menu.dat' files to take the new info into account.
<li>Default boot options can be altered in the first 3 lines of 'isolinux.cfg'. If you edit this file, make sure that you use a text editor that understands unix-files, otherwise you'll have one giant line in your editor and the newly created iso will probably fail to start anyway.
<li>You can remove or alter the 'warn.1st' file if you want. This file is displayed at the start of the textual menu.
<li>Alter 'openmsx-menu.randomlist.pl' if you want to change the software that is started after a time-out in the textual menu.
</ul>
<li>Once you've altered the content to your whishes, reboot your PC so that the openMSX-CD is started and as extra boot parameter enter 'remaster' again.
<li>The programs will now take the new info in the directories in the same directory as the 'remaster-openmsx-here'' file and create a new ISO image,your computer will be halted soon as this is ready.
<li>If you didn't alter the 'isolinux.cfg' file, then you can test your new CD image by booting again from your existing openMSX-CD and use the extra bootparameter 'bootfrom=<i>&lt;isoimage&gt;</i>'. The exact name of <i>&lt;isoimage&gt;</i> will be given to you by the remastyer program itself during the previous step.
<li>Reboot in your normal OS and use your regular CD-writer software to burn this new CD image to a real CD.<br>

</ol>

<h2>The manual way</h2>
<p>The steps described below assume that you are using a not to outdated Linux distribution and have some intermediate experience with Linux and command line tools.
You'll also need root-privilege for some of these steps.<br>
Probably the only valid reason why you shouldn't use the automatic procedure described above, is when you are using an non ext2/3 filesystem.
</p>
<ol>
<li>Make sure that you have sufficient free diskspace on your partitions, you'll need to be able to store 2 CD's extra on it. first the original content and then the ISO image you're going to create.
<li>Create a directory to store your working copy of this CD. In the rest of this text I'll assume that it will be in /tmp/old-cd, but feel free to chose any location you desire.
<li>Copy the entire content of this CD into this working directory. If your CD is mounted on /cdrom you can use something like:<pre>cp -a /cdrom/* /tmp/old-cd/</pre>. The -a option makes sure that the permissions on the files are preserved.
<li>Copy the files you want to add to the correct directory. fi:
<ul>
<li>system roms: place them under <i>/tmp/old-cd/</i>opt/openMSX/share/systemroms or in <i>/tmp/old-cd/</i>opt/openMSX/share/machines/&lt;machine-name&gt;/roms
<li>extra disk images or cartridges:
<ul>
<li>copy the files in a subdirectory under <i>/tmp/old-cd/</i>/openMSX/SOFTWARE/
<li>copy one of the menu.dat files from an other subdirectory under <i>/tmp/old-cd/</i>/openMSX/SOFTWARE/ towards your newly created subdirectory
<li>edit this menu.dat file to accomodate for the new files
<li>go to the directory <i>/tmp/old-cd/</i>/openMSX/ and run the program ./create-softdb.pl
</ul>
</ul>
<li>remove the file <i>/tmp/old-cd/</i>/openMSX/warn.1st
<li>replace the file <i>/tmp/old-cd/</i>/autorun.bat with <i>/tmp/old-cd/</i>/autorun.bat.clean
<li>changedir into <i>/tmp/old-cd/</i>
<li>run mkisofs with the following options
<pre>mkisofs -v -input-charset ISO-8859-15 -pad -l -r -J \
-sort /tmp/knoppix.sort \
-V "personal_openMSX-CD" -A "your_name" \
-no-emul-boot -boot-load-size 4 -boot-info-table -b boot/isolinux/isolinux.bin -c boot/isolinux/boot.cat \
-hide-rr-moved  -o /tmp/new-cd.iso <i>/tmp/old-cd/</i>
</pre>
<li>Burn the new iso image on a CD, for instance with
<pre>
cdrecord --scanbus
</pre>
to find out the device number of your CD-burner and 
<pre>
cdrecord -v -dao -pad -eject driveropts=burnfree  dev=<i>0,0,0</i> speed=4 /tmp/new-cd.iso 
</pre>
where you replace the <i>0,0,0</i> with the device number you obtained from the &quot;cdrecord -scanbus&quot; command
</ol>
</p>


</BODY>
</HTML>

